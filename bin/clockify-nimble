#!/usr/bin/env bash
# Wrapper to run clockify-nimble from any directory.
# Install: ln -sf "$(pwd)/bin/clockify-nimble" /usr/local/bin/clockify-nimble

resolve_script() {
  local src="$1"
  while [ -L "$src" ]; do
    local dir
    dir=$(dirname "$src")
    src=$(readlink "$src")
    [ "${src:0:1}" != "/" ] && src="$dir/$src"
  done
  echo "$src"
}

SCRIPT=$(resolve_script "$0")
BIN_DIR=$(cd "$(dirname "$SCRIPT")" && pwd)
CLOCK_DIR=$(dirname "$BIN_DIR")

PYTHON=""
[ -x "$CLOCK_DIR/venv/bin/python" ] && PYTHON="$CLOCK_DIR/venv/bin/python"
[ -x "$CLOCK_DIR/.venv/bin/python" ] && PYTHON="$CLOCK_DIR/.venv/bin/python"
[ -z "$PYTHON" ] && { echo "venv not found in $CLOCK_DIR (venv/ or .venv/)"; exit 1; }

exec "$PYTHON" "$CLOCK_DIR/main.py" "$@"
